<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="SIN001p_07DAO">

	<resultMap id="boardMap" type="java.util.Map"> 
		<result property="CONTENT" column="CONTENT" javaType="java.lang.String" jdbcType="CLOB" typeHandler="org.apache.ibatis.type.ClobTypeHandler" /> 
	</resultMap>

		
	<select id="cheanHonSelect" parameterType="kr.co.o2i.util.CommonMap" resultType="java.util.Map">
		SELECT
		      SIN_BOK.TEMPLE_CD,
		      SIN.BUD_NO AS DEAD_BUD_NO,
		      SIN_DAE.BUD_NO AS DAEJU_BUD_NO,
		      SIN_BOK.BUD_NO AS BOKWIJA_NO,
		      SIN_DAE.ADDR1 || ' ' || SIN_DAE.ADDR2 || ' ' ||  FN_ADDR_BLDG2(SIN_DAE.BLDG_NUM) AS ADDR1,
		      SIN_DAE.ADDR2 AS ADDR2,
		      SIN_DAE.ZIP_CD AS ZIP_CD,
		      SIN_DEATH.BON,
		      '亡'||SIN_BOK.DECE_REL AS DECE_REL,
		      SIN_BOK.HYO_REL,
		      ACM_BON.NAME || ACM_SEX.NAME AS BON_NM,
		      SIN.NAME_KOR,
		      SIN_BW.BUD_CODE,
		      SIN_BW.SORT_SEQ AS SIN_SORT_SEQ,
		      SIN_BOK.SORT_SEQ AS BOK_SORT_SEQ,
		      'T' AS CHECK_P,
		      SIN_BW.NAME_KOR AS BOK_NAME_KOR,
		      ACM_BOK.NAME AS BOKWI_NM,
		      '영가' AS DEATH_KOR,
		      '靈駕' AS DEATH_HAN
		FROM
		    SIN_DEATH_BOKWI_INFO  SIN_BOK,
		    SIN_DEATH_INFO        SIN_DEATH,
		    SIN_CARD_MASTER       SIN,
		    SIN_CARD_MASTER       SIN_BW,
		    SIN_CARD_MASTER       SIN_DAE,
		    ASP_CODE_MGT          ACM_BON,
		    ASP_CODE_MGT          ACM_SEX,
		    ASP_CODE_MGT          ACM_BOK
		WHERE 
		      SIN_BOK.TEMPLE_CD         = SIN_DEATH.TEMPLE_CD
		      AND SIN_BOK.DECE_BUD_NO   = SIN_DEATH.BUD_NO
		      AND SIN_DEATH.TEMPLE_CD   = SIN.TEMPLE_CD
		      AND SIN_DEATH.BUD_NO      = SIN.BUD_NO
		      AND SIN_BOK.TEMPLE_CD     = SIN_BW.TEMPLE_CD
		      AND SIN_BOK.BUD_NO        = SIN_BW.BUD_NO
		      AND SIN_BW.TEMPLE_CD      = SIN_DAE.TEMPLE_CD
		      AND SIN_BW.DAEJU_BUD_NO   = SIN_DAE.BUD_NO
		      AND SIN_BW.DEL_YN         = 'F'
		      AND SIN.DEL_YN            = 'F'
		      AND SIN_BOK.DEL_YN        = 'F'
		      AND ACM_BON.GROUP_CD(+)   = 'BON'
		      AND ACM_BON.CODE(+)       =  SIN_DEATH.BON
		      AND ACM_SEX.GROUP_CD(+)   = 'DEATH_SEXGBN'
		      AND ACM_SEX.CODE(+)       =  SIN.SEX_GBN
		      AND ACM_BOK.GROUP_CD(+)   = 'BOKWIGBN'
		      AND ACM_BOK.CODE(+)       = SIN_BOK.BOKWI_KIBU_GBN
		      AND SIN_BOK.TEMPLE_CD     = #{V_TEMPLE_CD}
		      AND SIN_BOK.BUD_NO     LIKE #{V_BUD_CODE} || '%'
		      AND SIN_BOK.BUD_NO NOT IN (SELECT BUD_NO FROM SIN_DEATH_INFO WHERE TEMPLE_CD = SIN_BOK.TEMPLE_CD)
		ORDER BY SIN_SORT_SEQ
			    ,BOK_SORT_SEQ
	</select>
	
	<select id="cheanHonSelectGbn" parameterType="kr.co.o2i.util.CommonMap" resultType="java.util.Map">
		SELECT
			SIN_BOK.TEMPLE_CD,
		    SIN.BUD_NO AS DEAD_BUD_NO,
		    SIN_BW.BUD_NO AS DAEJU_BUD_NO,
		    SIN_BOK.BUD_NO AS BOKWIJA_NO,
		    SIN_BW.ADDR1 AS ADDR1,
		    SIN_BW.ADDR2 AS ADDR2,
		    TRIM(SIN_BW.ADDR1 || NVL2(SIN_BW.ADDR2,' ' ||SIN_BW.ADDR2,NULL)) || ' ' ||  FN_ADDR_BLDG2(SIN_BW.BLDG_NUM) AS ADDR,
		    SIN_DAE.ZIP_CD AS ZIP_CD,
		    SIN_DEATH.BON,
		    DECODE(SPIRITUAL_GBN,'2','','망') AS MANG,
		    SIN_BOK.DECE_REL AS DECE_REL,
		    SIN_BOK.HYO_REL,
		    ACM_BON.NAME || ACM_SEX.NAME AS BON_SGBN,
		    SIN.NAME_KOR,
		    DECODE(EQUAL_GBN,'2','동일') || NVL(ACM_SPI.NAME,'영가') AS SPIRITUAL_GBN,
		    SIN_BW.BUD_CODE,
		    SIN_BW.SORT_SEQ AS SIN_SORT_SEQ,
		    SIN_BOK.SORT_SEQ AS BOK_SORT_SEQ,
		    2 AS DEATH_SORT_SEQ,
		    'T' AS CHECK_P,
		    SIN_BW.NAME_KOR AS BOKWI_NAME_KOR,
		    SIN_BOK.DEATH_YN,
		    ACM_DYN.NAME AS DEATH_GBN,
		    NVL(SIN_BOK.BOKWI_KIBU_GBN,'T') AS BOKWI_KIBU_GBN,
		    (SELECT NAME FROM ASP_CODE_MGT WHERE GROUP_CD = 'BOKWIGBN' AND CODE = NVL(SIN_BOK.BOKWI_KIBU_GBN,'T')) AS BOKWI_KIBU_GBN_NM,
		    SIN_BOK.BUD_NO || SIN_BOK.DEATH_YN AS PAGE_SKIP,
		    NULL PRAY_NM,
		    SUVILA.FN_TEMPLE_INFO(#{V_TEMPLE_CD},'PRINT_FORM_YN') PRINT_FORM_YN,
		    '../com/img/bg/report_chonhon_bg.gif' BACK_IMAGE
		FROM SIN_DEATH_BOKWI_INFO	SIN_BOK,
			SIN_DEATH_INFO			SIN_DEATH,
			SIN_CARD_MASTER			SIN,
			SIN_CARD_MASTER			SIN_BW,
			SIN_CARD_MASTER			SIN_DAE,
			ASP_CODE_MGT			ACM_BON,
			ASP_CODE_MGT			ACM_SEX,
		    ASP_CODE_MGT			ACM_SPI,
		    ASP_CODE_MGT			ACM_DYN
		WHERE 
			SIN_BOK.TEMPLE_CD 			= SIN_DEATH.TEMPLE_CD
			AND SIN_BOK.DECE_BUD_NO 	= SIN_DEATH.BUD_NO
			AND SIN_DEATH.TEMPLE_CD 	= SIN.TEMPLE_CD
			AND SIN_DEATH.BUD_NO 		= SIN.BUD_NO
			AND SIN_BOK.TEMPLE_CD 		= SIN_BW.TEMPLE_CD
			AND SIN_BOK.BUD_NO    		= SIN_BW.BUD_NO
			AND SIN_BW.TEMPLE_CD 		= SIN_DAE.TEMPLE_CD
			AND SIN_BW.DAEJU_BUD_NO 	= SIN_DAE.BUD_NO
			AND SIN_BW.DEL_YN 			= 'F'
			AND SIN.DEL_YN 				= 'F'
			AND SIN_BOK.DEL_YN 			= 'F'
			AND ACM_BON.GROUP_CD(+)   	= 'BON'
			AND ACM_BON.CODE(+)       	=  SIN_DEATH.BON
			AND ACM_SEX.GROUP_CD(+)   	= 'DEATH_SEXGBN'
			AND ACM_SEX.CODE(+)       	=  SIN.SEX_GBN
			AND ACM_SPI.GROUP_CD(+)   	= 'SPIRITUAL_GBN'
			AND ACM_SPI.CODE(+)       	=  SIN_BOK.SPIRITUAL_GBN
			AND ACM_DYN.GROUP_CD(+)   	= 'DEATH_GBN'
			AND ACM_DYN.CODE(+)       	=  SIN_BOK.DEATH_YN
			AND SIN_BOK.TEMPLE_CD 		= #{V_TEMPLE_CD}
			AND SIN_BOK.BUD_NO 		LIKE #{V_BUD_CODE} || '%'
			AND SIN_BOK.BUD_NO NOT IN (SELECT BUD_NO FROM SIN_DEATH_INFO WHERE TEMPLE_CD = SIN_BOK.TEMPLE_CD)
		ORDER BY SIN_BW.SORT_SEQ
		       , SIN_BW.BUD_NO
		       , SIN_BOK.DEATH_YN
		       , SIN_BOK.SORT_SEQ
	</select>
	
	
	<select id="selectcheanHonGbn" parameterType="kr.co.o2i.util.CommonMap" resultType="java.util.Map">
		SELECT
			SIN_BOK.TEMPLE_CD,
		    SIN_DAE.ADDR1 AS ADDR1,
		    SIN_DAE.ADDR2 AS ADDR2,
		    NULL AS ADDR,
		    NULL AS MANG,
		    SIN_BOK.DECE_REL AS DECE_REL,
		    SIN_BOK.HYO_REL,
		    ACM_BON.NAME AS BON,
		    SIN.SEX_GBN,
		    ACM_BON.NAME || ACM_SEX.NAME AS BON_SGBN,
		    SIN.NAME_KOR,
		    SIN_BOK.EQUAL_GBN,
		    SIN_BOK.SPIRITUAL_GBN AS SPIRITUAL_GBN_CD,
		    NULL AS SPIRITUAL_GBN,
		    SIN_BW.BUD_CODE,
		    SIN_BOK.SORT_SEQ,
		    NULL AS BOKWI_NAME_KOR,
		    SIN_BOK.DEATH_YN,
		    NULL AS BOKWI_KIBU_GBN_NM,
			'T' AS CHECK_P 
		FROM SIN_DEATH_BOKWI_INFO	SIN_BOK,
			SIN_DEATH_INFO			SIN_DEATH,
			SIN_CARD_MASTER			SIN,
			SIN_CARD_MASTER			SIN_BW,
			SIN_CARD_MASTER			SIN_DAE,
			ASP_CODE_MGT			ACM_BON,
			ASP_CODE_MGT			ACM_SEX,
		    ASP_CODE_MGT			ACM_SPI,
		    ASP_CODE_MGT			ACM_DYN
		WHERE 
			SIN_BOK.TEMPLE_CD 			= SIN_DEATH.TEMPLE_CD
			AND SIN_BOK.DECE_BUD_NO 	= SIN_DEATH.BUD_NO
			AND SIN_DEATH.TEMPLE_CD 	= SIN.TEMPLE_CD
			AND SIN_DEATH.BUD_NO 		= SIN.BUD_NO
			AND SIN_BOK.TEMPLE_CD 		= SIN_BW.TEMPLE_CD
			AND SIN_BOK.BUD_NO    		= SIN_BW.BUD_NO
			AND SIN_BW.TEMPLE_CD 		= SIN_DAE.TEMPLE_CD
			AND SIN_BW.DAEJU_BUD_NO 	= SIN_DAE.BUD_NO
			AND SIN_BW.DEL_YN 			= 'F'
			AND SIN.DEL_YN 				= 'F'
			AND SIN_BOK.DEL_YN 			= 'F'
			AND ACM_BON.GROUP_CD(+)   	= 'BON'
			AND ACM_BON.CODE(+)       	=  SIN_DEATH.BON
			AND ACM_SEX.GROUP_CD(+)   	= 'DEATH_SEXGBN'
			AND ACM_SEX.CODE(+)       	=  SIN.SEX_GBN
			AND ACM_SPI.GROUP_CD(+)   	= 'SPIRITUAL_GBN'
			AND ACM_SPI.CODE(+)       	=  SIN_BOK.SPIRITUAL_GBN
			AND ACM_DYN.GROUP_CD(+)   	= 'DEATH_GBN'
			AND ACM_DYN.CODE(+)       	=  SIN_BOK.DEATH_YN
			AND SIN_BOK.TEMPLE_CD 		= #{V_TEMPLE_CD}
			AND SIN_BOK.BUD_NO 			= #{V_BOKWI_BUD_NO}
			AND SIN_BOK.DEATH_YN		= #{V_DEATH_GBN}
		AND SIN_BOK.BUD_NO NOT IN (SELECT BUD_NO FROM SIN_DEATH_INFO WHERE TEMPLE_CD = SIN_BOK.TEMPLE_CD)
		ORDER BY SIN_BW.SORT_SEQ
				,SIN_BW.BUD_NO
				,SIN_BOK.DEATH_YN
				,SIN_BOK.SORT_SEQ
	</select>
	
	
	<select id="SELECT_SIN_DEATH_BOKWIJA" parameterType="kr.co.o2i.util.CommonMap" resultType="java.util.Map">
		SELECT '' AS TEMPLE_CD
			  ,'00000' AS BUD_NO
			  ,'전체' AS NAME_KOR
			  ,'' AS DEATH_YN
			  ,'' AS NAME
			  ,0 AS SORT_SEQ
			  ,'' AS SEX_GBN
			  ,'' AS HYO_REL
			  ,'' AS BOKWI_KIBU_GBN
			  ,'전체' DISPLAY
			  ,'전체' DISPLAY_TEMP
			  ,'00000' FIND_VALUE
			  ,'00000' FIND_VALUE_TEMP
		  FROM DUAL
		 UNION ALL
		SELECT DISTINCT DEA.TEMPLE_CD
			  ,DEA.BUD_NO
			  ,SIN.NAME_KOR
			  ,DEA.DEATH_YN
			  ,ACM.NAME
			  ,SIN.SORT_SEQ
			  ,SIN.SEX_GBN
			  ,'' as HYO_REL
			  ,DEA.BOKWI_KIBU_GBN
			  ,SIN.NAME_KOR || ' - ' || ACM.NAME as DISPLAY
			  ,SIN.NAME_KOR || ' - ' ||  ACM.NAME  || ' - ' ||
			  	(CASE 
			  		WHEN DEA.BOKWI_KIBU_GBN  = 'F' THEN '기부'
			  		ELSE '복위'
			  	 END ) as DISPLAY_TEMP
			  ,DEA.BUD_NO||DEA.DEATH_YN  as FIND_VALUE
			  ,DEA.BUD_NO||DEA.DEATH_YN|| DEA.BOKWI_KIBU_GBN as FIND_VALUE_TEMP			
		  FROM SIN_DEATH_BOKWI_INFO DEA
		  	  ,SIN_CARD_MASTER SIN
		  	  ,ASP_CODE_MGT ACM
		 WHERE DEA.TEMPLE_CD = SIN.TEMPLE_CD
		   AND DEA.BUD_NO      = SIN.BUD_NO
		   AND DEA.BUD_NO LIKE #{V_BUD_CODE} || '%'
		   AND DEA.TEMPLE_CD   = #{V_TEMPLE_CD}
		   AND ACM.GROUP_CD(+) = 'DEATH_GBN'
		   AND ACM.CODE(+)     =  DEA.DEATH_YN
		   AND SIN.DEL_YN      = 'F'
		   AND DEA.DEL_YN      = 'F'
		   AND SIN.BUD_NO NOT IN (SELECT BUD_NO FROM SIN_DEATH_INFO WHERE TEMPLE_CD = SIN.TEMPLE_CD )
			ORDER BY SORT_SEQ, DEATH_YN
	</select>
	
	
	<select id="cheanHonSelect_20120306" parameterType="kr.co.o2i.util.CommonMap" resultType="java.util.Map">
		SELECT
			SIN_BOK.TEMPLE_CD,
			'' AS DEAD_BUD_NO,
			SIN_DAE.BUD_NO AS DAEJU_BUD_NO,
			SIN.BUD_NO AS BOKWIJA_NO,
			SIN_DAE.ADDR1,
			SIN_DAE.ADDR2,
			SIN_DAE.ZIP_CD,
			'' AS BON,
			'' AS DECE_REL,
			SIN_BOK.HYO_REL,
			'' AS BON_SGBN,
			SIN.NAME_KOR,
			ACM_BOK.NAME AS BOKWI_KIBU_GBN,
			SIN.BUD_CODE,
			SIN.SORT_SEQ AS SIN_SORT_SEQ,
			MIN(SIN_BOK.SORT_SEQ) AS BOK_SORT_SEQ,
			1 AS DEATH_SORT_SEQ,
			'T' AS CHECK_P
		FROM 
			 SIN_DEATH_BOKWI_INFO SIN_BOK,
			 SIN_CARD_MASTER	  SIN,
			 SIN_CARD_MASTER	  SIN_DAE,
			 SIN_CARD_MASTER	  SIN_DEATH,
			 ASP_CODE_MGT		  ACM_BOK
		WHERE SIN_BOK.TEMPLE_CD 		= SIN.TEMPLE_CD
			  AND SIN_BOK.BUD_NO 		= SIN.BUD_NO	  
			  AND SIN.TEMPLE_CD 		= SIN_DAE.TEMPLE_CD
			  AND SIN.DAEJU_BUD_NO  	= SIN_DAE.BUD_NO
			  AND SIN_BOK.TEMPLE_CD     = SIN_DEATH.TEMPLE_CD
			  AND SIN_BOK.DECE_BUD_NO   = SIN_DEATH.BUD_NO
			  AND SIN.DEL_YN            = 'F'
			  AND SIN_DEATH.DEL_YN      = 'F'
			  AND SIN_BOK.DEL_YN        = 'F'
			  AND ACM_BOK.GROUP_CD(+) 	= 'BOKWIGBN'
			  AND ACM_BOK.CODE(+) 		= SIN_BOK.BOKWI_KIBU_GBN
			  AND SIN_BOK.HYO_REL   	IS NOT NULL
			  AND SIN_BOK.TEMPLE_CD 	= #{V_TEMPLE_CD} 
			  AND SIN_BOK.BUD_NO 		LIKE #V_BUD_CODE# || '%'
			  AND SIN_BOK.BUD_NO NOT IN (SELECT BUD_NO FROM SIN_DEATH_INFO WHERE TEMPLE_CD = SIN_BOK.TEMPLE_CD)
		GROUP BY SIN_BOK.TEMPLE_CD
		       , SIN_DAE.BUD_NO
		       , SIN.BUD_NO
		       , SIN_DAE.ADDR1
		       , SIN_DAE.ADDR2
		       , SIN_DAE.ZIP_CD
		       , SIN_BOK.HYO_REL
		       , SIN.NAME_KOR
		       , ACM_BOK.NAME
		       , SIN.BUD_CODE
		       , SIN.SORT_SEQ
		UNION ALL
		SELECT
			  SIN_BOK.TEMPLE_CD,
			  SIN.BUD_NO AS DEAD_BUD_NO,
			  '' AS DAEJU_BUD_NO,
			  SIN_BOK.BUD_NO AS BOKWIJA_NO,
			  SIN_DAE.ADDR1 AS ADDR1,
			  SIN_DAE.ADDR2 AS ADDR2,
			  SIN_DAE.ZIP_CD AS ZIP_CD,
			  SIN_DEATH.BON,
			  '亡 '||SIN_BOK.DECE_REL AS DECE_REL,
			  '' AS HYO_REL,
			  ACM_BON.NAME || ACM_SEX.NAME AS BON_SGBN,
			  SIN.NAME_KOR,
			  '영가' AS BOKWI_KIBU_GBN,
			  SIN_BW.BUD_CODE,
			  SIN_BW.SORT_SEQ AS SIN_SORT_SEQ,
			  SIN_BOK.SORT_SEQ AS BOK_SORT_SEQ,
			  2 AS DEATH_SORT_SEQ,
			  'T' AS CHECK_P
		FROM
			SIN_DEATH_BOKWI_INFO	SIN_BOK,
			SIN_DEATH_INFO			SIN_DEATH,
			SIN_CARD_MASTER			SIN,
			SIN_CARD_MASTER			SIN_BW,
			SIN_CARD_MASTER			SIN_DAE,
			ASP_CODE_MGT			ACM_BON,
			ASP_CODE_MGT			ACM_SEX
		WHERE 
			  SIN_BOK.TEMPLE_CD 		= SIN_DEATH.TEMPLE_CD
			  AND SIN_BOK.DECE_BUD_NO 	= SIN_DEATH.BUD_NO
			  AND SIN_DEATH.TEMPLE_CD 	= SIN.TEMPLE_CD
			  AND SIN_DEATH.BUD_NO 		= SIN.BUD_NO
			  AND SIN_BOK.TEMPLE_CD 	= SIN_BW.TEMPLE_CD
			  AND SIN_BOK.BUD_NO    	= SIN_BW.BUD_NO
			  AND SIN_BW.TEMPLE_CD 		= SIN_DAE.TEMPLE_CD
			  AND SIN_BW.DAEJU_BUD_NO 	= SIN_DAE.BUD_NO
			  AND SIN_BW.DEL_YN         = 'F'
			  AND SIN.DEL_YN            = 'F'
			  AND SIN_BOK.DEL_YN        = 'F'
			  AND ACM_BON.GROUP_CD(+)   = 'BON'
			  AND ACM_BON.CODE(+)       =  SIN_DEATH.BON
			  AND ACM_SEX.GROUP_CD(+)   = 'DEATH_SEXGBN'
			  AND ACM_SEX.CODE(+)       =  SIN.SEX_GBN
			  AND SIN_BOK.TEMPLE_CD 	= #{V_TEMPLE_CD} 
			  AND SIN_BOK.BUD_NO 		LIKE #{V_BUD_CODE} || '%'
			  AND SIN_BOK.BUD_NO NOT IN (SELECT BUD_NO FROM SIN_DEATH_INFO WHERE TEMPLE_CD = SIN_BOK.TEMPLE_CD)
		ORDER BY SIN_SORT_SEQ
			    ,BOK_SORT_SEQ
			    ,DEATH_SORT_SEQ
	</select>
	
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="REC002W_15DAO">

	<resultMap id="boardMap" type="java.util.Map"> 
		<result  property="CONTENT"    column="CONTENT"      javaType="java.lang.String" jdbcType="CLOB" typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		 
	</resultMap>


	<select id="SELECT_ID_DONGCHAM_PRINT" parameterType="kr.co.o2i.util.CommonMap"  resultMap="boardMap">
	    SELECT REC_MST.TEMPLE_CD
		      ,REC_MST.ACCEPT_SEQ || REC_SUB.SEQ as ACCEPT_SEQ
		      ,REC_SUB.SEQ
		      ,REC_JOIN.SORT_SEQ
		      ,REC_MST.PROPOSAL_BUD_NO 
		      ,FN_SINDO_INFO('NAME_KOR',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO) PROPOSAL_BUD_NAME 
		      ,REC_DTL.INDEUNG_GBN
		      ,FN_BIZ_NAME('INDEUNG',REC_MST.TEMPLE_CD,REC_DTL.ACCEPT_GBN,REC_DTL.INDEUNG_GBN) INDEUNG_NM 
		      ,REC_JOIN.DONGCHAM_BUD_NO 
		      ,FN_SINDO_INFO('NAME_KOR',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO) DONGCHAM_BUD_NAME
		      ,FN_SINDO_INFO('GANJI_NM',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO) DONGCHAM_GANJI 
		      ,REC_JOIN.LIGHT_NO
		      ,REC_DTL.JUNGAK_CD 
		      ,FN_BIZ_NAME('JUNGAK',REC_MST.TEMPLE_CD,REC_DTL.ACCEPT_GBN,REC_DTL.JUNGAK_CD) JUNGAK_NM
		      ,FN_DAEJU_INFO('ADDR1',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ)||' '||FN_DAEJU_INFO('ADDR2',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ) DAEJU_ADDR1
		      ,FN_DAEJU_INFO('ZIPCD',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ) DAEJU_ZIPCD 
		      ,FN_DAEJU_INFO('BUD_NO',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ) DAEJU_BUD_NO
		      ,(SELECT REPRESEN_REL 
		      	  FROM SIN_CARD_MASTER 
		      	 WHERE TEMPLE_CD =REC_MST.TEMPLE_CD 
		      	    AND REC_JOIN.DONGCHAM_BUD_NO = BUD_NO 
		      	    AND ROWNUM =1 
		      	    AND DEL_YN ='F' ) AS REPRESEN_REL
		      ,REC_DTL.CLOSE_YN
		      ,FN_SINDO_INFO('TEL',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO) PROPOSAL_TEL
		      ,FN_SINDO_INFO('CEL',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO) PROPOSAL_CEL
		      ,(SELECT NAME  FROM ASP_CODE_MGT WHERE GROUP_CD = 'SEXGBN'  AND CODE = FN_SINDO_INFO('SEXGBN',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO) )  SEXGBN                
		      ,FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO) BIRTHDAY
		      ,REC_MST.MEMO
		      ,REC_DTL.REMARK
		      ,(CASE
			     WHEN length(REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO), ' ', '')) >=4   
			     	AND SUBSTR( REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO), ' ', '') , 0, 4) &lt;&gt; '0000'  
			     	AND SUBSTR( REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO), ' ', '') , 0, 4) > 1900 
			     	AND SUBSTR( REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO), ' ', '') , 0, 4) &lt; 2020
			        THEN (to_char(sysdate, 'YYYY') - substr(REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO), ' ', ''),0,4 )+1)||''
			     ELSE ''
			    END   ) AGE
			  ,(SELECT NAME  FROM ASP_CODE_MGT WHERE GROUP_CD = 'SEXGBN'  AND CODE = FN_SINDO_INFO('SEXGBN',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO) )  PROPOSAL_SEXGBN
		      ,FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO) PROPOSAL_BIRTHDAY                   
		      ,(CASE
			     WHEN length(REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO), ' ', '')) >=4   
			     	AND SUBSTR( REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO), ' ', '') , 0, 4) &lt;&gt; '0000'  
			     	AND SUBSTR( REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO), ' ', '') , 0, 4) > 1900 
			     	AND SUBSTR( REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO), ' ', '') , 0, 4) &lt; 2020
			        THEN (to_char(sysdate, 'YYYY') - substr(REPLACE(FN_SINDO_INFO('BIRTHDAY',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO), ' ', ''),0,4 )+1)||''
			     ELSE ''
			    END   ) as PROPOSAL_AGE
		  FROM REC_MASTER REC_MST
		      ,REC_SUB REC_SUB
		      ,REC_INDEUNG_DETAIL REC_DTL
		      ,REC_INDEUNG_JOIN_MGT REC_JOIN
		 WHERE REC_MST.TEMPLE_CD    = #{V_TEMPLE_CD}
		   AND REC_MST.ACCEPT_DATE  BETWEEN #{V_ACCEPT_SDATE} AND #{V_ACCEPT_EDATE}
		   AND REC_MST.DEL_YN       = 'F'
		   AND REC_SUB.TEMPLE_CD    = REC_MST.TEMPLE_CD
		   AND REC_SUB.ACCEPT_SEQ   = REC_MST.ACCEPT_SEQ
		   AND REC_SUB.DEL_YN       = 'F'
		   AND REC_DTL.TEMPLE_CD    = REC_SUB.TEMPLE_CD
		   AND REC_DTL.ACCEPT_SEQ   = REC_SUB.ACCEPT_SEQ
		   AND REC_DTL.SEQ          = REC_SUB.SEQ
		   AND REC_DTL.DEL_YN       = 'F'
		   AND REC_JOIN.TEMPLE_CD   = REC_DTL.TEMPLE_CD
		   AND REC_JOIN.ACCEPT_SEQ  = REC_DTL.ACCEPT_SEQ
		   AND REC_JOIN.SEQ         = REC_DTL.SEQ
		   AND REC_JOIN.ACCEPT_GBN  = REC_DTL.ACCEPT_GBN
		   AND REC_JOIN.JUNGAK_CD   = REC_DTL.JUNGAK_CD
		   AND REC_JOIN.LIGHT_NO    = REC_DTL.LIGHT_NO
		   AND REC_JOIN.DEL_YN       = 'F'
		   <if test="V_CLOSE_YN != '' and V_CLOSE_YN != null  ">
		   	AND REC_DTL.CLOSE_YN = #{V_CLOSE_YN}
		   </if>
		   <if test="V_PROPOSAL_BUD_NO != '' and V_PROPOSAL_BUD_NO != null  ">
		   	AND REC_MST.PROPOSAL_BUD_NO LIKE SUBSTR(#{V_PROPOSAL_BUD_NO},0,10) || '%' 
		   </if>
		   <if test="V_JUNGAK_CD != '' and V_JUNGAK_CD != null and V_JUNGAK_CD != 0 ">
		   	AND REC_DTL.JUNGAK_CD = #{V_JUNGAK_CD}
		   </if>
		   <if test="V_ANIMAL_CD != '' and V_ANIMAL_CD != null  ">
		   	AND FN_SINDO_INFO('GANJI',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO) IN (SELECT CODE 
		   																				FROM ASP_CODE_MGT 
		   																			   WHERE GROUP_CD = 'GANJI' 
		   																			     AND ETC1     = #{V_ANIMAL_CD})
		   </if>
		   <if test="V_ADDR1 != '' and V_ADDR1 != null  ">
			AND FN_DAEJU_INFO('ADDR1',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ) LIKE '%'||#{V_ADDR1}||'%'
		   </if>
		   <if test="V_CODE != '' and V_CODE != null and V_CODE != 0 ">
		   	AND REC_DTL.INDEUNG_GBN = #{V_CODE}
		   </if>
		   <if test="V_CLASS_CD != '' and V_CLASS_CD != null and V_CLASS_CD != 0 ">
		   	AND REC_MST.PROPOSAL_BUD_NO IN (SELECT BUD_NO 
		   									  FROM SIN_CLASS_INFO 
		   									 WHERE TEMPLE_CD = #{V_TEMPLE_CD} 
		   									   AND CLASS_CD  = #{V_CLASS_CD})
		   </if>
		ORDER BY  REC_MST.ACCEPT_SEQ
		         ,REC_MST.PROPOSAL_BUD_NO
		         ,REC_DTL.ACCEPT_GBN
		         ,REC_DTL.JUNGAK_CD
		         ,REC_DTL.INDEUNG_GBN
		         ,REC_JOIN.DONGCHAM_BUD_NO
		         ,REC_JOIN.SORT_SEQ
	</select>
	
	<select id="SELECT_YD_DONGCHAM_PRINT" parameterType="kr.co.o2i.util.CommonMap"  resultMap="boardMap">
		SELECT REC_MST.TEMPLE_CD
		      ,REC_MST.ACCEPT_SEQ
		      ,REC_SUB.SEQ
		      ,REC_JOIN.SORT_SEQ
		      ,REC_MST.PROPOSAL_BUD_NO 
		      ,FN_SINDO_INFO('NAME_KOR',REC_MST.TEMPLE_CD,REC_MST.PROPOSAL_BUD_NO) PROPOSAL_BUD_NAME
		      ,REC_DTL.YEONDEUNG_GBN as INDEUNG_GBN
		      ,FN_BIZ_NAME('INDEUNG',REC_MST.TEMPLE_CD,REC_DTL.ACCEPT_GBN,REC_DTL.YEONDEUNG_GBN) INDEUNG_NM 
		      ,REC_JOIN.DONGCHAM_BUD_NO 
		      ,FN_SINDO_INFO('NAME_KOR',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO) DONGCHAM_BUD_NAME 
		      ,FN_SINDO_INFO('GANJI_NM',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO) DONGCHAM_GANJI 
		      ,REC_JOIN.LIGHT_NO 
		      ,REC_DTL.JUNGAK_CD 
		      ,FN_BIZ_NAME('JUNGAK',REC_MST.TEMPLE_CD,REC_DTL.ACCEPT_GBN,REC_DTL.JUNGAK_CD) JUNGAK_NM 
		      ,FN_DAEJU_INFO('ADDR1',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ)||' '||FN_DAEJU_INFO('ADDR2',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ) DAEJU_ADDR1 
		      ,FN_DAEJU_INFO('ZIPCD',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ) DAEJU_ZIPCD 
		      ,FN_DAEJU_INFO('BUD_NO',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ) DAEJU_BUD_NO 
		      ,(SELECT REPRESEN_REL 
		      	  FROM SIN_CARD_MASTER 
		      	 WHERE TEMPLE_CD =REC_MST.TEMPLE_CD 
		      	   AND REC_JOIN.DONGCHAM_BUD_NO = BUD_NO 
		      	   AND ROWNUM =1 
		      	   AND DEL_YN ='F' ) AS REPRESEN_REL
		      ,REC_DTL.CLOSE_YN
		  FROM REC_MASTER REC_MST
		      ,REC_SUB REC_SUB
		      ,REC_YEONDEUNG_DETAIL REC_DTL
		      ,REC_YEONDEUNG_JOIN_MGT REC_JOIN
		 WHERE REC_MST.TEMPLE_CD    = #{V_TEMPLE_CD}
		   AND REC_MST.ACCEPT_DATE  BETWEEN #{V_ACCEPT_SDATE} AND #{V_ACCEPT_EDATE}
		   AND REC_MST.DEL_YN       = 'F'
		   AND REC_SUB.TEMPLE_CD    = REC_MST.TEMPLE_CD
		   AND REC_SUB.ACCEPT_SEQ   = REC_MST.ACCEPT_SEQ
		   AND REC_SUB.DEL_YN       = 'F'
		   AND REC_DTL.TEMPLE_CD    = REC_SUB.TEMPLE_CD
		   AND REC_DTL.ACCEPT_SEQ   = REC_SUB.ACCEPT_SEQ
		   AND REC_DTL.SEQ          = REC_SUB.SEQ
		   AND REC_DTL.DEL_YN       = 'F'
		   AND REC_JOIN.TEMPLE_CD   = REC_DTL.TEMPLE_CD
		   AND REC_JOIN.ACCEPT_SEQ  = REC_DTL.ACCEPT_SEQ
		   AND REC_JOIN.SEQ         = REC_DTL.SEQ
		   AND REC_JOIN.ACCEPT_GBN  = REC_DTL.ACCEPT_GBN
		   AND REC_JOIN.JUNGAK_CD   = REC_DTL.JUNGAK_CD
		   AND REC_JOIN.LIGHT_NO    = REC_DTL.LIGHT_NO
		   AND REC_JOIN.DEL_YN       = 'F'
		   <if test="V_CLOSE_YN != '' and V_CLOSE_YN != null  ">
		   	AND REC_DTL.CLOSE_YN = #{V_CLOSE_YN}
		   </if>
		   <if test="V_PROPOSAL_BUD_NO != '' and V_PROPOSAL_BUD_NO != null  ">
		   	AND REC_MST.PROPOSAL_BUD_NO LIKE SUBSTR(#{V_PROPOSAL_BUD_NO},0,10) || '%'
		   </if>
		   <if test="V_JUNGAK_CD != '' and V_JUNGAK_CD != null and V_JUNGAK_CD != 0 ">
		   	AND REC_DTL.JUNGAK_CD = #{V_JUNGAK_CD}
		   </if>
		   <if test="V_ANIMAL_CD != '' and V_ANIMAL_CD != null  ">
		   	AND FN_SINDO_INFO('GANJI',REC_MST.TEMPLE_CD,REC_JOIN.DONGCHAM_BUD_NO) IN (SELECT CODE 
		   																				FROM ASP_CODE_MGT 
		   																			   WHERE GROUP_CD = 'GANJI' 
		   																			     AND ETC1     = #{V_ANIMAL_CD})
		   </if>
		   <if test="V_ADDR1 != '' and V_ADDR1 != null  ">
		   	AND FN_DAEJU_INFO('ADDR1',REC_MST.TEMPLE_CD,REC_MST.ACCEPT_SEQ) LIKE '%'||#{V_ADDR1}||'%'
		   </if>
		   <if test="V_CODE != '' and V_CODE != null and V_CODE != 0 ">
		   	AND REC_DTL.YEONDEUNG_GBN = #{V_CODE} 
		   </if>
		   <if test="V_CLASS_CD != '' and V_CLASS_CD != null and V_CLASS_CD != 0 ">
		   	AND REC_MST.PROPOSAL_BUD_NO IN (SELECT BUD_NO 
		   									  FROM SIN_CLASS_INFO 
		   									 WHERE TEMPLE_CD = #{V_TEMPLE_CD} 
		   									   AND CLASS_CD  = #{V_CLASS_CD})
		   </if>	
		ORDER BY  REC_MST.ACCEPT_SEQ
		         ,REC_MST.PROPOSAL_BUD_NO
		         ,REC_DTL.ACCEPT_GBN
		         ,REC_DTL.JUNGAK_CD
		         ,REC_DTL.YEONDEUNG_GBN
		         ,REC_JOIN.DONGCHAM_BUD_NO
		         ,REC_JOIN.SORT_SEQ
	</select>
	
	
	
</mapper>